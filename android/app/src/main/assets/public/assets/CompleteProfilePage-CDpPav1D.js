import{c as g,r,u as G,b as T,h as W,j as e,L as R,U as V,B as $,s as v}from"./index-s1Im0gGd.js";import{I as k}from"./Input-BKp795_O.js";import{A as H}from"./Alert-DQovq92X.js";import{C as J}from"./calendar-8PhAnDAA.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=g("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=g("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function se(){const[m,u]=r.useState(""),[i,L]=r.useState(""),[p,E]=r.useState(""),[o,U]=r.useState(null),[_,b]=r.useState(!1),[y,h]=r.useState(""),[q,N]=r.useState(!1),[x,B]=r.useState([]),[f,w]=r.useState(!0),[n,I]=r.useState(null),{user:d,profile:C,updateUser:S}=G(),z=T(),A=W();r.useEffect(()=>{(async()=>{try{w(!0);const c=(await(await fetch("https://restcountries.com/v3.1/all?fields=name,cca2,idd")).json()).map(a=>({name:a.name.common,code:a.cca2,phoneCode:a.idd.root+(a.idd.suffixes[0]||"")})).sort((a,l)=>a.name.localeCompare(l.name));B(c)}catch(t){console.error("Error fetching countries:",t),h("Impossible de charger la liste des pays. Veuillez réessayer plus tard.")}finally{w(!1)}})()},[]),r.useEffect(()=>{if(i){const s=x.find(t=>t.name===i);I(s||null),s!=null&&s.phoneCode&&!m.startsWith(s.phoneCode)&&u(s.phoneCode)}},[i,x]);const M=s=>{s.target.files&&s.target.files.length>0&&U(s.target.files[0])},F=s=>{const t=s.target.value;n!=null&&n.phoneCode&&!t.startsWith(n.phoneCode)?u(n.phoneCode+t.replace(/^\+?\d+/,"")):u(t)},O=async s=>{if(s.preventDefault(),!!d){b(!0),h(""),N(!1);try{let t=null;if(o){const c=o.name.split(".").pop(),a=`${d.id}/avatar.${c}`,{error:l}=await v.storage.from("avatars").upload(a,o,{upsert:!0});if(l)throw l;const{data:D}=v.storage.from("avatars").getPublicUrl(a);t=D.publicUrl}const{error:j}=await v.from("users").update({phone_number:m,country:i,date_of_birth:p?new Date(p).toISOString():null,profile_avatar_url:t,is_profile_complete:!0,updated_at:new Date().toISOString()}).eq("id",d.id);if(j)throw j;S&&await S(),N(!0),setTimeout(()=>{var a,l;const c=((l=(a=A.state)==null?void 0:a.from)==null?void 0:l.pathname)||"/";z(c,{replace:!0})},2e3)}catch(t){h(t.message||"Une erreur est survenue lors de la mise à jour du profil.")}finally{b(!1)}}};return!d||!C?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(R,{className:"w-8 h-8 animate-spin text-primary"})}):q?e.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"Profil complété avec succès !"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"Bienvenue sur Africage ! Votre compte est maintenant prêt à l'emploi."}),e.jsx("div",{className:"text-sm text-neutral-500",children:"Redirection vers l'accueil..."})]})}):e.jsx("div",{className:"min-h-screen bg-neutral-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{className:"w-8 h-8 text-primary"})}),e.jsxs("h1",{className:"text-2xl font-bold text-neutral-800 mb-2",children:["Bienvenue, ",C.first_name," !"]}),e.jsx("p",{className:"text-neutral-600",children:"Encore une étape pour sécuriser votre compte."})]}),y&&e.jsx("div",{className:"mb-4",children:e.jsx(H,{type:"error",message:y})}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700",children:[e.jsx(Q,{className:"w-4 h-4 inline mr-1"}),"Téléphone"]}),e.jsx(k,{type:"tel",value:m,onChange:F,placeholder:(n==null?void 0:n.phoneCode)||"+221",required:!0}),n&&e.jsxs("p",{className:"text-xs text-neutral-500 mt-1",children:["Indicatif automatique : ",n.phoneCode]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700",children:[e.jsx(J,{className:"w-4 h-4 inline mr-1"}),"Date de naissance"]}),e.jsx(k,{type:"date",value:p,onChange:s=>E(s.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700",children:[e.jsx(K,{className:"w-4 h-4 inline mr-1"}),"Pays de résidence"]}),e.jsxs("select",{value:i,onChange:s=>L(s.target.value),className:"w-full px-4 py-3 border border-neutral-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0,disabled:f,children:[e.jsx("option",{value:"",children:f?"Chargement des pays...":"Sélectionnez votre pays"}),x.map(s=>e.jsx("option",{value:s.name,children:s.name},s.code))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700",children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Photo de profil (optionnel)"]}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-neutral-300 border-dashed rounded-lg",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-neutral-400"}),e.jsxs("div",{className:"flex text-sm text-neutral-600",children:[e.jsxs("label",{htmlFor:"avatar-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none",children:[e.jsx("span",{children:"Téléversez une image"}),e.jsx("input",{id:"avatar-upload",name:"avatar-upload",type:"file",className:"sr-only",onChange:M,accept:"image/*"})]}),e.jsx("p",{className:"pl-1",children:"ou glissez-déposez"})]}),e.jsx("p",{className:"text-xs text-neutral-500",children:"PNG, JPG, GIF jusqu'à 5MB"})]})}),o&&e.jsxs("p",{className:"text-sm text-neutral-600 mt-2",children:["Fichier sélectionné : ",o.name]})]}),e.jsx($,{type:"submit",loading:_,className:"w-full bg-primary hover:bg-primary/90 text-white",disabled:f,children:"Compléter mon profil"})]})]})})})}export{se as CompleteProfilePage};
