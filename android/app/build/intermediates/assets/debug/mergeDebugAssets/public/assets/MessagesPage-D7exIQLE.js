import{u as d,r as a,j as e,L as u,M as h,a as p,U as f,s as j}from"./index-s1Im0gGd.js";import{S as v}from"./server-crash-DZrP2UOO.js";import{I as N}from"./inbox-B89tADt3.js";import{P as g}from"./package-D_gg4fgx.js";function E(){const{user:t}=d(),[n,o]=a.useState([]),[m,i]=a.useState(!0),[l,x]=a.useState(null);return a.useEffect(()=>{(async()=>{if(t)try{i(!0);const{data:s,error:c}=await j.from("conversations").select(`
            id,
            shipment:shipments(title),
            sender:users!conversations_sender_id_fkey(id, first_name, last_name, profile_picture),
            traveler:users!conversations_traveler_id_fkey(id, first_name, last_name, profile_picture)
          `).or(`sender_id.eq.${t.id},traveler_id.eq.${t.id}`);if(c)throw c;o(s||[])}catch(s){x("Impossible de charger vos conversations."),console.error("Error fetching conversations:",s)}finally{i(!1)}})()},[t]),m?e.jsx("div",{className:"min-h-screen bg-neutral-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(u,{className:"w-12 h-12 text-primary animate-spin"})})}):l?e.jsxs("div",{className:"min-h-screen bg-neutral-50 py-12 px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx(v,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-red-700",children:"Une erreur est survenue"}),e.jsx("p",{className:"text-red-600 mt-2",children:l})]}):e.jsx("div",{className:"min-h-screen bg-neutral-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx(h,{className:"w-8 h-8 text-accent mr-4"}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-neutral-800",children:"Mes Messages"})]}),n.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-4xl shadow-lg",children:[e.jsx(N,{className:"w-16 h-16 text-neutral-400 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-neutral-700",children:"Aucune conversation"}),e.jsx("p",{className:"text-neutral-500 mt-2",children:"Lorsqu'une offre est acceptée, une conversation est créée ici."})]}):e.jsx("div",{className:"bg-white rounded-4xl shadow-lg p-6 space-y-4",children:n.map(r=>{const s=(t==null?void 0:t.id)===r.sender.id?r.traveler:r.sender;return e.jsx(p,{to:`/messages/${r.id}`,className:"block p-4 rounded-2xl hover:bg-neutral-50 transition-colors border border-neutral-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s.profile_picture?e.jsx("img",{src:s.profile_picture,alt:s.first_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-neutral-200 flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-neutral-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-neutral-800",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"flex items-center text-sm text-neutral-500 mt-1",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:r.shipment.title})]})]})]})},r.id)})})]})})}export{E as MessagesPage};
