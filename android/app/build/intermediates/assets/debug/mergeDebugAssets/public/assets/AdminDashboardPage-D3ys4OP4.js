import{c as v,r,j as e,L as b,s as u,B as w,U as A,u as k,b as T,S as C}from"./index-s1Im0gGd.js";import{U as D}from"./users-Bj9vDve4.js";import{P as S}from"./package-D_gg4fgx.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=v("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=v("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function U(){const[a,n]=r.useState(null),[d,o]=r.useState(!0),[x,i]=r.useState(null);return r.useEffect(()=>{(async()=>{try{o(!0),i(null);const[c,s]=await Promise.all([u.rpc("get_total_user_count"),u.rpc("get_total_shipment_count")]);if(c.error)throw c.error;if(s.error)throw s.error;n({totalUsers:c.data||0,totalShipments:s.data||0})}catch(c){i("Erreur lors du chargement des statistiques"),console.error("Stats error:",c)}finally{o(!1)}})()},[]),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{className:"w-8 h-8 text-primary animate-spin"})}):x||!a?e.jsx("div",{className:"text-center py-8 bg-red-50 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:x||"Aucune statistique disponible"})}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg text-center border border-neutral-200",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(D,{className:"w-12 h-12 text-blue-500"})}),e.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:a.totalUsers.toLocaleString()}),e.jsx("p",{className:"text-neutral-600",children:"Utilisateurs inscrits"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg text-center border border-neutral-200",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(S,{className:"w-12 h-12 text-green-500"})}),e.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:a.totalShipments.toLocaleString()}),e.jsx("p",{className:"text-neutral-600",children:"Colis publiés"})]})]})}function M(){const[a,n]=r.useState([]),[d,o]=r.useState(!0),[x,i]=r.useState(null);r.useEffect(()=>{l()},[]);const l=async()=>{try{o(!0),i(null);const{data:s,error:m}=await u.from("users").select("id, email, first_name, last_name, is_banned").order("created_at",{ascending:!1});if(m)throw m;n(s||[])}catch(s){i("Erreur lors du chargement des utilisateurs"),console.error("Users fetch error:",s)}finally{o(!1)}},c=async(s,m)=>{const h=!m,y=h?"bannir":"réactiver";if(window.confirm(`Êtes-vous sûr de vouloir ${y} cet utilisateur ?`))try{const{error:p}=await u.from("users").update({is_banned:h}).eq("id",s);if(p)throw p;n(N=>N.map(j=>j.id===s?{...j,is_banned:h}:j))}catch(p){i("Erreur lors de la mise à jour de l'utilisateur"),console.error("Ban toggle error:",p)}};return d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{className:"w-8 h-8 text-primary animate-spin"})}):x?e.jsxs("div",{className:"text-center py-8 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-red-600",children:x}),e.jsx(w,{onClick:l,className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 font-mono",children:s.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:s.email}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:[s.first_name," ",s.last_name]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.is_banned?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.is_banned?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Banni"]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Actif"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx(w,{variant:"outline",size:"sm",onClick:()=>c(s.id,s.is_banned),className:`${s.is_banned?"border-green-500 text-green-600 hover:bg-green-50":"border-red-500 text-red-600 hover:bg-red-50"}`,children:s.is_banned?"Réactiver":"Bannir"})})]},s.id))})]})}),a.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-neutral-500",children:"Aucun utilisateur trouvé."})})]})}function q(){const[a,n]=r.useState([]),[d,o]=r.useState(!0),[x,i]=r.useState(null),[l,c]=r.useState("all"),[s,m]=r.useState(!1);r.useEffect(()=>{h()},[l]);const h=async()=>{try{o(!0),i(null);let t=u.from("shipments").select("id, title, user_id, status, created_at").order("created_at",{ascending:!1});l!=="all"&&(t=t.eq("status",l)),s&&(t=t.in("status",["IN_TRANSIT","COMPLETED"]));const{data:f,error:g}=await t;if(g)throw g;n(f||[])}catch(t){i("Erreur lors du chargement des colis"),console.error("Shipments fetch error:",t)}finally{o(!1)}},y=async t=>{if(window.confirm("Êtes-vous sûr de vouloir supprimer définitivement ce colis ?"))try{const{error:f}=await u.from("shipments").delete().eq("id",t);if(f)throw f;n(g=>g.filter(_=>_.id!==t))}catch(f){i("Erreur lors de la suppression du colis"),console.error("Delete error:",f)}},p=t=>{switch(t){case"PENDING_MATCH":return"bg-yellow-100 text-yellow-800";case"MATCHED":return"bg-blue-100 text-blue-800";case"IN_TRANSIT":return"bg-purple-100 text-purple-800";case"COMPLETED":return"bg-green-100 text-green-800";case"CANCELED":return"bg-red-100 text-red-800";default:return"bg-neutral-100 text-neutral-800"}},N=t=>{switch(t){case"PENDING_MATCH":return"En attente";case"MATCHED":return"Correspondance trouvée";case"IN_TRANSIT":return"En transit";case"COMPLETED":return"Livré";case"CANCELED":return"Annulé";default:return t}},j=Array.from(new Set(a.map(t=>t.status)));return d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{className:"w-8 h-8 text-primary animate-spin"})}):x?e.jsxs("div",{className:"text-center py-8 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-red-600",children:x}),e.jsx(w,{onClick:h,className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>m(!s),className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${s?"bg-accent text-white":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),s?"Voir tous les colis":"Voir les transactions"]})}),!s&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-neutral-600",children:"Filtrer par statut:"}),e.jsxs("select",{value:l,onChange:t=>c(t.target.value),className:"border border-neutral-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"Tous"}),j.map(t=>e.jsx("option",{value:t,children:N(t)},t))]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-neutral-200",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Titre"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Utilisateur"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Date de création"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-neutral-200",children:a.map(t=>e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 font-mono",children:t.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:t.title}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 font-mono",children:t.user_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p(t.status)}`,children:N(t.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:new Date(t.created_at).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>y(t.id),className:"border-red-500 text-red-600 hover:bg-red-50",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Supprimer"]})})]},t.id))})]})}),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-neutral-300 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500",children:s?"Aucune transaction trouvée.":"Aucun colis trouvé pour ce filtre."})]})]})}function F(){const{user:a,profile:n}=k(),d=T(),[o,x]=r.useState(!0);return r.useEffect(()=>{(async()=>{if(!a){d("/");return}if(!(n!=null&&n.is_admin)){if(n===null){const{data:l,error:c}=await u.from("users").select("is_admin").eq("id",a.id).single();if(c||!(l!=null&&l.is_admin)){d("/");return}}else if(!n.is_admin){d("/");return}}x(!1)})()},[a,n,d]),o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-600",children:"Vérification des permissions..."})]})}):e.jsx("div",{className:"min-h-screen bg-neutral-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx(C,{className:"w-12 h-12 text-accent mr-3"}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-neutral-800",children:"Panneau d'Administration"})]}),e.jsx("p",{className:"text-xl text-neutral-600",children:"Gérez les utilisateurs, les colis et visualisez les statistiques de la plateforme."})]}),e.jsxs("div",{className:"space-y-12",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-6 text-center",children:"Statistiques de la Plateforme"}),e.jsx(U,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-6 text-center",children:"Gestion des Utilisateurs"}),e.jsx(M,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold text-neutral-800 mb-6 text-center",children:"Gestion des Colis"}),e.jsx(q,{})]})]})]})})}export{F as AdminDashboardPage};
